## 回路設計
<img width="1000" height="600" alt="Image" src=/エアデータ製作/ハードウェア/回路・基板製作/Airdata.svg>

- SD書き込み関しては時間がかかるため，一番通信速度の速いSPI通信([SDのピン配置](https://ht-deko.com/arduino/micro_sdcard.html))
  
- センサとマイコンはI2C通信
  
- マイコンとメインマイコンはUART
  - RRXT → Raspberry pi pico RX - XIAO RP2040 TX
    
  - RTXR → Raspberry pi pico TX - XIAO RP2040 RX
 
- センサとSDの電源入力はマイコンの3.3V出力のピンとつなげる

- マイコンには電源(外部)から5Vを供給する

- I2Cに関してはAS5600が2個使う+AS5600がI2Cアドレスの変更ができないため，チャンネルを2つ使う

- 今回はAS5600(AoA用)とpitotube(差圧センサ)にチャンネル1を使い，それ以外はチャンネル0を用いた  
  (AoAとAoSのセンサでチャンネルが分けられれば他はどのチャンネルに割り当てても変わらない)

<img width="600" height="600" alt="Image" src="https://github.com/user-attachments/assets/b1b33ced-eec5-4249-8b09-bd3cd86d32fe" />

- XIAO RP2040のピン配置は上の画像(本来は[こっち](https://wiki.seeedstudio.com/ja/XIAO-RP2040/#%E5%9B%9E%E8%B7%AF%E5%9B%B3%E3%82%AA%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%93%E3%83%A5%E3%83%BC%E3%82%A2)のピン配置が正しいがこのピン配置でも動作することが分かった)

  - 注意点はあるので[このサイト](https://tamanegi-digick.com/it/xiao2040rp/)を読んでおく

## 基板設計
<img width="1000" height="600" alt="Image" src="https://github.com/user-attachments/assets/a6f18b60-9cc5-41f3-98c9-bdeae474929a" />

- 基盤の縦の長さはセンサを全て配置でき，センサの基盤が外に飛び出さない最小の長さにした。

- 基盤の左右にコネクタを配置
  - 片方は基板に配置できない差圧センサとの接続用(I2C)
    
  - もう片方はメイン基板との接続用(UART)
 
- 基盤の長さをできるだけ短くしたかったのでSDカードスロットに関しては基板の裏面に配置
  
  - 実装の際にはんだ付けできるようにSDカードスロットのピン配置と他のセンサの位置を重ならないように少しずらした

- 基盤には固定具取り付け用のねじ穴を計5個配置する

- AoAのセンサを基板に足して横向き(垂直方向)に取り付ける形状，基板の形は写真のようないびつな形になった。

<img width="280" height="280" alt="Image" src="https://github.com/user-attachments/assets/5c926a99-5425-429b-86b2-fdcf2b876bfe" /> 

- もともとは上の写真(あざみ野)のようにエアデータセンサの基盤とAoAとAoSの基盤を分けて作るつもりだったが以下のような問題点があった
  - 基盤を分けて作るのはめんどくさい(部品が多くなるのは嫌だ)
 
  - パイプ内に基盤を固定する必要があるので固定具の作製の難易度が上昇する
 
  - 基盤をパイプに入れるとき，CFRPのパイプであるため基板を押し込む必要があり，この形状ではそれが厳しい(取り出したり，メンテナンスができない可能性がある)

- 平面の基板に垂直ピンや垂直取り付け台によってセンサを横向きに取り付けることできる

  - 上記の問題点をある程度解消できる
 
  - 基板設計を行う仮定で


  
