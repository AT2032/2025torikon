# 2025　電装班
(もっと早くに書いておくべきだった)  
書き方は23代のブログの構成のパクリ → [偉大な先輩のブログ(23代製作資料)](https://771-8bit.com/blog/birdman-glider-avionics/)
# 要求定義
要求は上から順に優先。フライトデータの取得よりも飛ぶことが優先
- システムの要求
  1. パイロットの操作でラダーを制御する
  2. プラットホーム上で姿勢の確認
  3. パイロットに速度と対地高度を伝達する
  4. フライトデータを取得する
- 電装班運営の要求
  1．必要な技術を継承する
# 要件定義
## 共通事項
### 非機能要件
- 信頼性
  - 故障による直接的な機能の喪失は認めるが，優先度が低いものの故障が高いものに影響を与えないような設計にする
    
    - 無線通信が混信しても他に影響を与えない
    - メイン電装のマイコンが停止しても操舵系は機能を維持する
    - SDカードが脱落しても他の機能は動作する
  - ソフトウェアのバグ，コクピフレームとの接触による短絡，通信線の切断などの故障を想定する
  - システムが複雑になるため基本的に冗長は組まず，予備部品の容易で対応する
- 安全性
  - 着水時に発煙・発火しない
  - パイロットの頭部付近(特にキャノピーより前)に電装を配置しない
- 稼働時間
  - 着水までバッテリーが持つ
    - 電圧の監視が可能である
    - バッテリーに最後にアクセスできるのは移動前(ハッチがある場合はこれ，ない場合はバッテリーに最後にアクセスできるのはフライト前日の機体組み立て開始時)
- 環境
  - 機体が直射日光にあたり温度が上昇しても動作する
  - 多少の水滴では故障せず動作し続ける
  - 直射日光下でLEDを見る必要がなく運用できる
  - トラックで輸送する場合，振動や熱に耐えられる
  - 機体の金属やCFRPの粉，琵琶湖の砂の対策がされている
- 運用
  - プラットフォーム上で電装の電源を起動できる
  - プラホ上での電装作業を最小限にする
- 開発環境・メンテナンス
  - 琵琶湖で機体を組んだ状態で電装のプログラムを変更できる
  - デバッグに必要な情報をなるべく多く出力する
- 拡張性
  -　とりあえずなし？
### 制約条件
- 電気的制約
  - SPIとI2Cは通信速度が速く，通信距離が短いため，基板内のみで使用
  - 基板間の通信はUARTでおこなう
  - マイコンの動作電圧は多くのセンサーに合わせて基本3.3V
- 技術的制約
  - Arduino IDEを使用し，自力でライブラリを書かなくてよい構成とする(できる限り)(ライブラリを作る場合は使い方を明記しておく)
  - CANはなるべく使用せず，UARTによる文字列送受信を行う
  - チップ部品は使用しない
  - ケーブルの圧着は基本せず，既製品を使用する
## 操舵
そもそもワイヤーリンケージかフライバイワイヤーかはチームにノウハウがあるかで決めていいと思う
鳥科では代々使われてノウハウがあるフライバイワイヤーを用いる

- パイロットの操作でラダーを制御する
  - 入力を読む
    - 去年まではジョイスティックを用いていたが，ジョイスティックではパイロットが体重移動しながらのラダー操作が難しい上に，直感的な操作がしにくいため，
    - アナログ入力を読むため，回転しやすい可変抵抗を取り付け，レバーの引き具合でラダーを制御できるようにする
    - 不感帯を含む，任意のカーブを設定できる
  - サーボモータを動かす
    - 十分なトルクがある
      - 風対策(逆電流防止)
    - 信号・電力の減衰が起きない
      - ケーブルが断線しない
      - ケーブルの電圧降下が小さい
      - テールまでの長いケーブルで問題なく信号伝達ができる
- その他の要件
  - トラブル時ニュートラルでフライトできる(これは機構側で担保 → ニュートラルロック)
  - プログラムを変更せずに琵琶湖でニュートラル調整が可能である(操舵範囲は事前調整)
  - テールを軽くする
    - バッテリーはコクピに搭載
    - 軽量なサーボを使用
  - 機体内通信を含む，無線通信で操舵を行ってはならない(大会ルール)
## テレメトリ
- プラホから発進時に姿勢などを確認できるようにする
  - 受信機はポケットに入る程度のサイズにする
    - PC・タブレットは大きくてプラットほーおむで扱いづらい(特に雨天時)
- デバッグのため，全センサーデータをダウンリンクする
## 高度速度計
パイロットからは高度や速度は分かりにくいため，測定したデータを何らかの手段を用いてパイロットに伝える必要がある
- パイロットに対地高度・対気速度を伝達する
  - 対地高度を推定する
    - 測定精度は0.1m単位を要求
    - 技術的な制約
      - 高高度では気圧高度を，低高度では超音波高度を信用すべき
        - 気圧高度は湖面からの絶対高度は分からない
        - 超音波は(ほとんどのセンサーで)高高度からでは届かない → 最近は最大測定距離が8mのものもあるけど，精度が怪しかったり，測定周期が遅かったりする
      - 気圧センサ
        - 動圧・ハッチの衝撃によるセンサーの外れ値を弾く
        - 中央値を取るために違う場所に3つの気圧センサを配置する
      - 超音波センサ
        - 水面付近は気圧高度より信用できる
  - 対気速度を測定する
    - 記録方法は後述
  - パイロットに情報を伝達する
    - 視覚は前方に集中するのでモニター等は使えない
    - 触角は操縦に影響するので使えない
    - 使えるのは聴覚のみ
  - その他の要件
    - フェールセーフ
      - センサーデータが取得できない場合，異常だと検知した場合は読み上げを行わない(ソフト側)
## ロガー
- 下記のデータを記録する  
| 優先度 | 測定値 | 備考 |
| :--- | :--- | :--- |
|  高  |  GPS  |  ある程度信頼できるため冗長の必要はない  |
|  高  |  超音波高度  |  超音波が干渉するため1つだけ搭載する  |
|  高  |  気圧高度  |  高度計の信頼性を確保できる分だけ搭載する  |
|  高  |  対気速度  |  ピトー管を機体の気流に影響されない位置に取り付ける  |
|  中  |  ラダー操作量  |  ラダー操作に影響を与えないように  |
|  中  |  9軸・姿勢  |  機体の向きとが正しく分かるようにぐらつかないしっかりした場所に載せる  |
|  低  |  AoA(Angle of Attack)・迎え角  |  ピッチ測定で十分だが，精度をこだわる場合は必要  |
|  低  |  AoS(Angle of Slip)・滑り角  |  代替手段がなく，AoAと同じく製作が高難度  |
